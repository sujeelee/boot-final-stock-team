<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kh.st.boot.dao.SearchDAO"> 
	<select id="stockSearch" resultType="kh.st.boot.model.dto.DashListDTO">
		SELECT 
		    a.st_code AS code, 
		    a.st_name AS stockName, 
		    b.si_price AS price, 
		    b.si_fltRt AS flt
		FROM 
		    stock a
		JOIN (
		    SELECT 
		        si1.st_code, 
		        si1.si_price, 
		        si1.si_vs, 
		        si1.si_fltRt
		    FROM 
		        stock_info si1
		    JOIN (
		        SELECT 
		            st_code, 
		            MAX(si_date) AS max_date
		        FROM 
		            stock_info
		        GROUP BY 
		            st_code
		    ) si2 ON si1.st_code = si2.st_code AND si1.si_date = si2.max_date
		) b ON a.st_code = b.st_code
		WHERE 
		    a.st_name LIKE CONCAT('%', #{stx}, '%')
		ORDER BY 
		    a.st_name ASC;
	</select>
	<select id="newsSearch" resultType="NewsVO">
		select b.ne_no, b.ne_title, b.ne_datetime, c.np_name 
		from news b 
		join newspaper c 
		ON b.np_no = c.np_no 
		where b.ne_title LIKE CONCAT('%', #{stx}, '%')
	</select>
</mapper>