<!DOCTYPE html>
<html 
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
	layout:decorate="~{layout/layout.html}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
	<style type="text/css">
		.entire {
			width: 700px;
			margin: 0 auto;
		}
		
		.news-header {
		    border-bottom: 1px solid #ccc;
		    padding-bottom: 7px;
		}
		
		.news-header h1 {
		    font-size: 24px;
		    color: #d63447;
		}
		
		.news-header h2 {
		    font-size: 30px;
		    font-weight: bold;
		}
		
		.sub-info {
		    font-size: 14px;
		    color: #888;
		}
		
		.sub-info span {
		    margin-right: 15px;
		}
		
		.reaction-bar {
		    padding: 10px 0;
		    border-bottom: 1px solid #ccc;
		    margin-bottom: 15px;
		}
		
		.reaction{
		 	font-size: 15px;
			color: #888;
		}
	
		.recommend-section {
		    margin-top: 30px;
		    border-top: 1px solid #ccc;
		    padding-top: 20px;
		    text-align: center;
		}
		
		.icon-bar {
		    display: flex;
		    justify-content: space-around;
		    margin-top: 20px;
		    margin-bottom: 20px;
		}
		
		.icon-item {
		    cursor: pointer;
		}
		
		.icon-text {
		    display: block;
		    font-size: 16px;
		    color: #888;
		    margin-bottom: 5px;
		}
		
		.icon {
			font-size: 25px;
		}
		
		.news-footer {
		    margin-top: 20px;
		    text-align: center;
		}
		
		.news-footer a {
		    color: #007BFF;
		    text-decoration: none;
		}
		
		.news-footer a:hover {
		    text-decoration: underline;
		}
		
		.icon-item input[type="checkbox"] {
			display: none; /* ë¼ë””ì˜¤ ë²„íŠ¼ì„ ìˆ¨ê¹ë‹ˆë‹¤ */
	   }
	   
	   .update-delete a {
			font-size: 16px;
			color: #888888; /* íšŒìƒ‰ */
			text-decoration: none;
			padding: 10px;
		}
		
		/* ë§ˆìš°ìŠ¤ í˜¸ë²„ ì‹œ ê²€ì€ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
		.update-delete a:hover {
			color: #000000; /* ê²€ì€ìƒ‰ */
		}
	</style>
</head>
<body>
	<main layout:fragment="content">
		<div class="entire mt-3">
			<header class="news-header">
	            <h1 th:text="${newspaper.np_name}"></h1>
	            <h2 th:text="${news.ne_title}"></h2>
	            <div class="d-flex">
		            <div class="sub-info mr-auto">
		                <span>ì…ë ¥</span>
		                <span th:text="${#dates.format(news.ne_datetime, 'yyyy-MM-dd HH:mm:ss')}"></span>
		                <span th:text="${news.ne_name} + ' ê¸°ì'"></span>
		            </div>
		            <div sec:authorize="isAuthenticated()" th:if="${#authentication.principal.member.mb_id} == ${news.mb_id}" class="update-delete">
		            	<a th:href="@{/newspaper/update/{ne_no}(ne_no=${news.ne_no})}">ìˆ˜ì •</a>
						<a th:href="@{/newspaper/delete/{ne_no}(ne_no=${news.ne_no})}">ì‚­ì œ</a>
		            </div>
	            </div>
	        </header>
	        <div class="reaction-bar">
	            <div class="reaction">
	                <span>ğŸ‘ ì¶”ì²œìˆ˜ (<span th:text="${totalCount}"></span>)</span>
	            </div>
	        </div>
	        <article>
	            <div th:utext="${news.ne_content}" style="min-height: 400px; height: auto; font-size: 18px;"></div>
	        </article>
	         <section class="recommend-section">
	            <strong>ì´ ê¸°ì‚¬ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤</strong>
	            <div class="icon-bar">
				    <label class="icon-item" for="em_1">
				        <input type="checkbox" name="em_act" id="em_1" value="1" onclick="checkOnlyOne(this);">
				        <span class="icon">ğŸ˜</span>
				        <span class="icon-text">ê¸°ë»ìš”</span>
				        <span th:text="${news.ne_happy}"></span>
				    </label>
				    <label class="icon-item" for="em_2">
				        <input type="checkbox" name="em_act" id="em_2" value="2" onclick="checkOnlyOne(this);">
				        <span class="icon">ğŸ¤¬</span>
				        <span class="icon-text">í™”ë‚˜ìš”</span>
				        <span th:text="${news.ne_angry}"></span>
				    </label>
				    <label class="icon-item" for="em_3">
				        <input type="checkbox" name="em_act" id="em_3" value="3" onclick="checkOnlyOne(this);">
				        <span class="icon">ğŸ˜²</span>
				        <span class="icon-text">í™©ë‹¹í•´ìš”</span>
				        <span th:text="${news.ne_absurd}"></span>
				    </label>
				    <label class="icon-item" for="em_4">
				        <input type="checkbox" name="em_act" id="em_4" value="4" onclick="checkOnlyOne(this);">
				        <span class="icon">ğŸ˜­</span>
				        <span class="icon-text">ìŠ¬í¼ìš”</span>
				        <span th:text="${news.ne_sad}"></span>
				    </label>
				</div>
	        </section>
	        <div class="news-footer mb-3">
	            <a  th:text="${newspaper.np_name} + ' ì–¸ë¡ ì‚¬í™ˆ ë°”ë¡œê°€ê¸°'"
	            	th:href="@{/newspaper/newsList/{np_no}/{date}(np_no=${newspaper.np_no},date=${ne_datetime})}"></a>
	        </div>
		</div>
        <script th:inline="javascript">
        	function checkLogin(){
        		let mb_id = /*[[${#authentication.getName()}]]*/ '';
	        	if(mb_id != 'anonymousUser') {
	        		return true;
	        	}
        		if(confirm('ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.\në¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ê² ìŠµë‹ˆê¹Œ?')){
    				location.href = "/member/login";
    			}
        		return false;
        	}
        
	        function checkOnlyOne(act) {
	        	if(!checkLogin()) {
	        		return;
	        	}
	            const checkboxes = $("input[name='em_act']");
	            checkboxes.each(function() {
	                $(this).prop('checked', false);
	            });
	            $(act).prop('checked', true);
	            let em_act = $(act).val();
	            let news_emoji = {
	            	ne_no : '[[${news.ne_no}]]',
	            	em_act : em_act
	            }
	            $.ajax({
	            	async : true,
	            	url : '/newspaper/emoji',
	            	type : 'post', 
	            	data : JSON.stringify(news_emoji), 
	            	contentType : "application/json; charset=utf-8",
	            	dataType : "json", 
	            	success : function (data){
	            		displayTotalCount(data.totalCount);
	            		displayNewsEmoji(data.news);
	            	}, 
	            	error : function(jqXHR, textStatus, errorThrown){
						console.log(jqXHR);
	            	}
	            });
	        }
	        function displayTotalCount(totalCount){
	        	str = `
	                <span>ğŸ‘ ì¶”ì²œìˆ˜ (${totalCount})</span>	
	        	`;
	        	$('.reaction').html(str);
	        }
	        function displayNewsEmoji(news){
	        	if(news == null) {
	        		return;
	        	}
	        	str = `
	        		<strong class="recommend-section">ì´ ê¸°ì‚¬ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤</strong>
	        		<div class="icon-bar">
					    <label class="icon-item" for="em_1">
					        <input type="checkbox" name="em_act" id="em_1" value="1" onclick="checkOnlyOne(this);">
					        <span class="icon">ğŸ˜</span>
					        <span class="icon-text">ê¸°ë»ìš”</span>
					        <span>${news.ne_happy}</span>
					    </label>
					    <label class="icon-item" for="em_2">
					        <input type="checkbox" name="em_act" id="em_2" value="2" onclick="checkOnlyOne(this);">
					        <span class="icon">ğŸ¤¬</span>
					        <span class="icon-text">í™”ë‚˜ìš”</span>
					        <span>${news.ne_angry}</span>
					    </label>
					    <label class="icon-item" for="em_3">
					        <input type="checkbox" name="em_act" id="em_3" value="3" onclick="checkOnlyOne(this);">
					        <span class="icon">ğŸ˜²</span>
					        <span class="icon-text">í™©ë‹¹í•´ìš”</span>
					        <span>${news.ne_absurd}</span>
					    </label>
					    <label class="icon-item" for="em_4">
					        <input type="checkbox" name="em_act" id="em_4" value="4" onclick="checkOnlyOne(this);">
					        <span class="icon">ğŸ˜­</span>
					        <span class="icon-text">ìŠ¬í¼ìš”</span>
					        <span>${news.ne_sad}</span>
					    </label>
					</div>
	        	`
	        	$('.recommend-section').html(str);
	        }
        </script>
	</main>
</body>
</html>