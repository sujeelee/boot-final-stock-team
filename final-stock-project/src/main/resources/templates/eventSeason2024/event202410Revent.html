<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout/layout.html}">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>시드키 : 이벤트 : 룰렛</title>
    <style>
        /* 룰렛 스타일 */
        #roulette {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            border: 5px solid #333;
            position: relative;
            margin: 0 auto;
            font-size: 20px;
            text-align: center;
            background: conic-gradient(
                #f94144 0% 20%, #f3722c 20% 40%, 
                #f8961e 40% 60%, #f9c74f 60% 80%, 
                #90be6d 80% 100%);
            transition: transform 4s ease-out;
            overflow: hidden;
        }

        /* 각 상품명을 회전 섹션과 함께 고정시킴 */
        .section-text {
            position: absolute;
            width: 100px;
            height: 50px;
            left: 50%;
            top: 50%;
            transform-origin: center -100px; /* 룰렛 원의 중심에서 바깥쪽으로 배치 */
            color: white;
            font-weight: bold;
            text-align: center;
        }

        /* 각 섹션에 대한 회전 각도 설정 */
        .section1 { transform: rotate(18deg) translateX(-50%); }
        .section2 { transform: rotate(90deg) translateX(-50%); }
        .section3 { transform: rotate(162deg) translateX(-50%); }
        .section4 { transform: rotate(234deg) translateX(-50%); }
        .section5 { transform: rotate(306deg) translateX(-50%); }

        #spinButton {
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <main layout:fragment="content">
        <div class="container text-center">
            <h2>룰렛 이벤트</h2>
            <div id="roulette">
                <!-- 각 섹션에 상품명 표시 -->
                <div class="section-text section1">상품1</div>
                <div class="section-text section2">상품2</div>
                <div class="section-text section3">상품3</div>
                <div class="section-text section4">상품4</div>
                <div class="section-text section5">상품5</div>
                <div id="roulette-text">룰렛을 돌려보세요!</div>
            </div>
            <button id="spinButton" class="btn btn-primary mt-3">돌려!</button>
        </div>

        <script>
            $(document).ready(function() {
                const items = ["상품1", "상품2", "상품3", "상품4", "상품5"];
                let isSpinning = false;
                let currentRotation = 0;  // 현재 회전 상태를 저장할 변수

                $("#spinButton").click(function() {
                    if (isSpinning) return; // 중복 클릭 방지
                    isSpinning = true;

                    // 기존 텍스트 및 스타일 초기화
                    $("#roulette-text").text("룰렛을 돌려보세요!");
                    $("#spinButton").text("돌리는 중...");
                    $("#roulette").css("transition", "none"); // 애니메이션 제거

                    // 초기화된 상태로 돌린 후 새로운 회전 각도 적용
                    currentRotation = currentRotation % 360; // 각도 값 유지
                    $("#roulette").css("transform", `rotate(${currentRotation}deg)`);

                    setTimeout(function() {
                        // 새 랜덤 각도 설정
                        let randomIndex = Math.floor(Math.random() * items.length);
                        let degree = currentRotation + 3600 + (360 / items.length) * randomIndex;  // 3600도 추가 회전

                        currentRotation = degree; // 현재 각도를 업데이트
                        $("#roulette").css({
                            "transform": "rotate(" + degree + "deg)",
                            "transition": "transform 4s ease-out"
                        });

                        // 룰렛 멈춤 후 결과 표시
                        setTimeout(function() {
                            $("#roulette-text").text(items[randomIndex]);
                            $("#spinButton").text("다시 돌리기");
                            isSpinning = false;
                        }, 4000);
                    }, 50); // CSS 리셋 후 적용할 딜레이
                });
            });
        </script>
    </main>
</body>

</html>
